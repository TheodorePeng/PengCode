# SavePage - Notion网页收藏扩展需求文档

## 1. 项目概述

开发一个名为SavePage的Chrome浏览器扩展，允许用户将浏览的网页无缝保存到Notion数据库中，自动提取页面元数据，防止重复添加，并支持灵活的数据属性映射。本项目旨在提供高效的网页收藏解决方案，帮助用户构建个性化的知识库。

## 2. 核心功能需求

### 2.1 基础保存功能
- 通过扩展图标或右键菜单一键保存网页到Notion
- 自动提取并保存网页标题、URL、描述、favicon和封面图等元数据
- 支持设置默认Notion数据库

### 2.2 智能重复检测
- 保存前自动检查数据库中是否存在相同URL的记录
- 发现重复时提供直接查看已有条目的选项
- 允许用户选择继续保存或取消操作

### 2.3 动态属性映射系统
- 自动获取并分析目标Notion数据库的属性结构
- 提供直观的界面让用户将网页数据映射到Notion属性
- 支持多种Notion属性类型：标题、富文本、URL、选择、多选、复选框、数字、日期等
- 保存用户的映射配置以便后续使用
- 支持属性可见性控制，允许用户隐藏不常用的属性

### 2.4 用户配置与偏好设置
- 安全存储Notion API令牌
- 管理默认数据库ID和映射配置
- 自定义保存行为（如是否使用封面图）
- 属性排序与显示控制

## 3. 技术架构

### 3.1 扩展组件结构
- 采用Chrome扩展Manifest V3规范
- 核心组件：
  - `background.js`: 处理后台逻辑、API请求和存储操作
  - `content.js`: 与网页交互，提取页面信息，创建UI界面
  - 内嵌对话框: 替代Chrome默认弹窗的网页内模态窗口

### 3.2 数据存储与管理
- 使用Chrome Storage API安全存储配置信息:
  - Notion API令牌
  - 默认数据库ID
  - 属性映射配置
  - 属性可见性设置
  - 用户界面偏好
- 使用loadConfig函数集中管理配置获取

### 3.3 Notion API集成
- 实现与Notion API的完整交互流程:
  - 数据库属性获取与分析
  - 重复条目检查
  - 页面创建与更新
- 支持健壮的错误处理和重试机制
- 通过buildNotionPageProperties函数动态构建符合Notion API要求的属性对象

## 4. 用户界面设计

### 4.1 设置对话框
- 初始化配置界面，收集Notion API令牌
- 提供详细的获取API令牌指引
- 确认和保存配置选项

### 4.2 保存对话框
- 页面预览区，显示待保存页面的标题、描述和封面图
- 数据库选择区，支持输入或选择目标数据库
- 属性映射界面，动态显示可映射的数据库属性
- 属性控制面板，支持属性可见性批量切换
- 操作按钮区，包含保存、取消等功能按钮

### 4.3 反馈与通知系统
- 操作成功通知（保存成功、设置更新等）
- 警告通知（重复URL提醒）
- 错误通知（API错误、网络问题等）
- 加载状态指示器

## 5. 用户体验与交互设计

### 5.1 对话框交互
- 所有对话框采用页面内嵌模式，提供充足的操作空间
- 支持通过点击遮罩层或ESC键关闭对话框
- 对话框动画过渡效果，提升体验流畅度
- 响应式布局，适应不同屏幕尺寸

### 5.2 属性映射交互
- 拖拽排序功能，允许用户调整属性显示顺序
- 属性可见性切换，快速隐藏/显示属性
- 标签控件支持多选和颜色指示
- 文本输入区自动调整高度

### 5.3 状态反馈
- 加载状态指示器，提供明确的视觉反馈
- 操作结果反馈，显示成功/失败状态
- 错误提示，提供具体错误信息和可能的解决方案

## 6. 错误处理与稳定性

### 6.1 错误防护机制
- API令牌验证与错误处理
- 网络连接问题的检测与重试
- 属性类型不匹配的智能处理
- 必要属性（如标题）缺失时的警告提示

### 6.2 性能优化
- 最小化对网页性能的影响
- 资源按需加载
- 数据库结构缓存，减少API调用
- 界面渲染优化

## 7. 扩展与优化方向

### 7.1 功能扩展
- 支持选择性保存网页部分内容
- 添加网页截图保存功能
- 支持多个默认数据库配置
- 实现批量保存功能
- 添加标签推荐系统

### 7.2 用户体验优化
- 增强数据库选择器，支持搜索和历史记录
- 预设属性映射模板
- 页面内容智能提取和分类
- 快捷键支持

### 7.3 集成增强
- 支持更多Notion高级属性类型
- 与Notion AI功能集成
- 离线保存功能，稍后同步到Notion
- 支持更多浏览器平台（Firefox、Edge等）

## 8. 实施策略

### 8.1 开发重点
- 确保核心保存功能可靠稳定
- 实现灵活而直观的属性映射系统
- 构建友好的用户界面和交互体验
- 完善的错误处理与用户反馈机制

### 8.2 测试与验证
- 全面测试不同类型网页的保存功能
- 验证各种Notion数据库结构的兼容性
- 用户界面在不同环境下的表现测试
- 错误场景模拟与恢复测试