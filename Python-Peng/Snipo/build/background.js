/*! For license information please see background.js.LICENSE.txt */
(()=>{var t={591:(t,e,r)=>{var n=r(8).default;function o(){"use strict";t.exports=o=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},r=Object.prototype,a=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function p(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{p({},"")}catch(t){p=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),i=new M(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return L()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=k(i,r);if(c){if(c===l)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=h(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,i),a}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var l={};function d(){}function m(){}function w(){}var b={};p(b,c,(function(){return this}));var x=Object.getPrototypeOf,v=x&&x(x(P([])));v&&v!==r&&a.call(v,c)&&(b=v);var y=w.prototype=d.prototype=Object.create(b);function g(t){["next","throw","return"].forEach((function(e){p(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function r(o,i,c,u){var s=h(t[o],t,i);if("throw"!==s.type){var p=s.arg,f=p.value;return f&&"object"==n(f)&&a.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):e.resolve(f).then((function(t){p.value=t,c(p)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var o;this._invoke=function(t,n){function a(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(a,a):a()}}function k(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function P(t){if(t){var e=t[c];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(a.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return m.prototype=w,p(y,"constructor",w),p(w,"constructor",m),m.displayName=p(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,p(t,s,"GeneratorFunction")),t.prototype=Object.create(y),t},e.awrap=function(t){return{__await:t}},g(_.prototype),p(_.prototype,u,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new _(f(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},g(y),p(y,s,"Generator"),p(y,c,(function(){return this})),p(y,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return i.type="throw",i.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=a.call(o,"catchLoc"),u=a.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},8:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},757:(t,e,r)=>{var n=r(591)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function e(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function n(t){return function(){var r=this,n=arguments;return new Promise((function(o,a){var i=t.apply(r,n);function c(t){e(i,o,a,c,u,"next",t)}function u(t){e(i,o,a,c,u,"throw",t)}c(void 0)}))}}var o=r(757),a=r.n(o),i="https://api.snipo.io",c="https://oauth.snipo.io";function u(t,e,r){return s.apply(this,arguments)}function s(){return s=n(a().mark((function t(e,r,n){var o,c,u,s,p,f,h,l=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=l.length>3&&void 0!==l[3]?l[3]:"youtube",t.prev=1,(c=new Headers).append("Authorization","Bearer "+e),c.append("Content-Type","application/json"),u=JSON.stringify({playlistData:r,dataVideo:n}),s={method:"POST",headers:c,body:u,redirect:"follow"},p="".concat(i,"/notion/").concat(o),"bilibili"===o&&""!==r.id&&(p+="/playlist"),t.next=11,fetch(p,s);case 11:if(401!==(f=t.sent).status){t.next=14;break}return t.abrupt("return",{error:"auth"});case 14:if(403!==f.status){t.next=22;break}return t.next=17,f.json();case 17:if(!t.sent.provider){t.next=20;break}return t.abrupt("return",{error:"auth-only-notion"});case 20:return chrome.tabs.create({url:chrome.runtime.getURL("/snipo-app/dist/index.html#/premium-popup")}),t.abrupt("return",{error:"payment"});case 22:if(200===f.status){t.next=30;break}return console.error("url: ".concat(p,", requestBody: ").concat(u,",  response: ").concat(f.status)),t.next=26,f.json();case 26:if(!("desc"in(h=t.sent))){t.next=29;break}return t.abrupt("return",{error:"Something wrong! The error description: "+h.desc});case 29:return t.abrupt("return",{error:"Something wrong! Support email: hello@snipo.io"});case 30:return t.next=32,f.json();case 32:return t.abrupt("return",t.sent);case 35:return t.prev=35,t.t0=t.catch(1),console.error(t.t0),t.abrupt("return",{error:"Something wrong! Support email: hello@snipo.io"});case 39:case"end":return t.stop()}}),t,null,[[1,35]])}))),s.apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=n(a().mark((function t(){var e,r,n,o,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,(e=new Headers).append("Content-Type","application/json"),r={method:"GET",headers:e,credentials:"include",redirect:"follow"},n="".concat(c,"/refresh-token"),t.next=7,fetch(n,r);case 7:if(200===(o=t.sent).status){t.next=11;break}return console.error("url: ".concat(n,", response: ").concat(o.status)),t.abrupt("return","");case 11:return t.next=13,o.json();case 13:if(!("token"in(i=t.sent))){t.next=16;break}return t.abrupt("return",i.token);case 16:return t.abrupt("return","");case 19:return t.prev=19,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return","");case 23:case"end":return t.stop()}}),t,null,[[0,19]])})))).apply(this,arguments)}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(e){return setTimeout(e,t)}))}function l(){switch(!0){case navigator.userAgent.indexOf("OPR/")>=0:return"opera";case d():return"brave";case navigator.userAgent.indexOf("YaBrowser/")>=0:return"yandex";case m():return"edge";case b():return"safari";case w():return"firefox";default:return"chrome"}}function d(){return!!navigator.brave}function m(){return navigator.userAgent.indexOf("Edg/")>=0||navigator.userAgent.indexOf("Edge/")>=0}function w(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function b(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function x(){switch(!0){case m():return"https://bit.ly/3S28Fjq";case d():return"https://bit.ly/3ZiPiGr";case w():return"https://bit.ly/3H94DDA";case b():return"https://bit.ly/3iErXzJ";default:return"https://bit.ly/3T3YMmM"}}function v(){switch(!0){case m():return"https://bit.ly/3RloKk7";case w():case b():default:return"https://bit.ly/3BPpZ5d"}}function y(t){return g.apply(this,arguments)}function g(){return(g=n(a().mark((function t(e){var r,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,{mode:"cors"});case 2:return r=t.sent,t.next=5,r.json();case 5:return n=t.sent,t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(t){return k.apply(this,arguments)}function k(){return(k=n(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.storage.local.get(e,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function I(t){return A.apply(this,arguments)}function A(){return(A=n(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.storage.local.set(e,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function M(t){return P.apply(this,arguments)}function P(){return(P=n(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.storage.sync.get(e,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function L(t){var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(e).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")),n=JSON.parse(r).exp;return Date.now()>=1e3*n-12e4}function O(){return j.apply(this,arguments)}function j(){return(j=n(a().mark((function t(){var e,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M(["notion_auth_token","auth_token"]);case 2:if(!(e=t.sent).auth_token){t.next=14;break}if(L(e.auth_token)){t.next=7;break}return t.abrupt("return",e.auth_token);case 7:return t.next=9,p();case 9:if(!(r=t.sent)){t.next=13;break}return t.next=13,S({auth_token:r});case 13:return t.abrupt("return",r);case 14:if(!e.notion_auth_token){t.next=16;break}return t.abrupt("return",e.notion_auth_token);case 16:return t.abrupt("return","");case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S(t){return T.apply(this,arguments)}function T(){return(T=n(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.storage.sync.set(e,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function E(t){return C.apply(this,arguments)}function C(){return(C=n(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.windows.create(e,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function R(t,e){return U.apply(this,arguments)}function U(){return(U=n(a().mark((function t(e,r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.windows.update(e,r,(function(){t()}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(t){return B.apply(this,arguments)}function B(){return(B=n(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.tabs.remove(e,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function N(t,e){return G.apply(this,arguments)}function G(){return(G=n(a().mark((function t(e,r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.tabs.update(e,r,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function F(t){return J.apply(this,arguments)}function J(){return(J=n(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.tabs.get(e,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Z(){return q.apply(this,arguments)}function q(){return(q=n(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.commands.getAll((function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Y(t,e){return z.apply(this,arguments)}function z(){return(z=n(a().mark((function t(e,r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.tabs.captureVisibleTab(e,r,(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function H(){return V.apply(this,arguments)}function V(){return(V=n(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_(["split_screen"]);case 2:return e=t.sent,t.abrupt("return",new Promise((function(t){w()||!0===e.split_screen?t([]):chrome.system.display.getInfo({},(function(e){t(e)}))})));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(){return W.apply(this,arguments)}function W(){return(W=n(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){chrome.system.display.getInfo({},(function(e){t(e)}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var X="https://api.mixpanel.com",$="undefined"!=typeof window?window.app=window.app||{}:self.app=self.app||{},Q={};$.analytics={init:function(t,e,r){Q.token=t,Q.distinct_id=e;var n=0,o=0;try{n=parseInt(((new Date).getTime()-parseInt(r))/1e3/2592e3),o=parseInt(((new Date).getTime()-parseInt(r))/1e3/31104e3)}catch(t){console.log(t)}Q.mAge=n,Q.yAge=o},track:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=chrome.runtime.getManifest(),o=n&&n.version?n.version:"none",a={distinct_id:Q.distinct_id,token:Q.token,mage:Q.mAge,yage:Q.yAge,version_id:o,browser:l()},i={event:t,properties:Object.assign(a,e)},c=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),u=X+"/track?data="+c;return w()||!1!==r||chrome.runtime.sendMessage({cmd:"mixpanel_request",url:u},(function(){})),u}};const tt=$;function et(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return rt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rt(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function nt(){return nt=n(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(a().mark((function t(){var e,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=function(){return(r=n(a().mark((function t(){var e,r,n,o,i,c,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return chrome.tabs.create({url:x()},(function(){})),t.next=3,chrome.tabs.query({url:["https://chrome.google.com/webstore/detail/video-notes-to-notion-ai/kojibkalenabblnhoihknojdfapbbmig*","https://chromewebstore.google.com/detail/video-notes-to-notion-ai/kojibkalenabblnhoihknojdfapbbmig*","https://microsoftedge.microsoft.com/addons/detail/ai-flashcards-video-note/agjpedhffklaicinofdjnaigdgehipea*","https://addons.mozilla.org/en-US/firefox/addon/snipo*"]});case 3:e=t.sent,r="","",n=et(e);try{for(n.s();!(o=n.n()).done;)i=o.value,(c=new URL(i.url)).searchParams.has("utm_source")&&(r=c.searchParams.get("utm_source")),c.searchParams.has("referral")&&(r=c.searchParams.get("referral"))}catch(t){n.e(t)}finally{n.f()}return u=Math.floor(68719476736*(1+Math.random())).toString(16).substring(1)+"9"+Math.floor(68719476736*(1+Math.random())).toString(16).substring(1),t.next=11,S({install_date:(new Date).getTime(),source:r,referral:"",uuid:u});case 11:return tt.analytics.init("e4c9b5b21e2fa0e9f7d70f28548f6391","unknown",(new Date).getTime()),t.next=14,y(tt.analytics.track("install_ext",{},!0));case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)},e=function(){return r.apply(this,arguments)},!chrome.runtime.onInstalled){t.next=6;break}chrome.runtime.onInstalled.addListener(function(){var t=n(a().mark((function t(r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("install"!=r.reason){t.next=7;break}return t.next=3,M("install_date");case 3:if(t.sent.install_date){t.next=7;break}return t.next=7,e();case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=12;break;case 6:return t.next=8,M("install_date");case 8:if(t.sent.install_date){t.next=12;break}return t.next=12,e();case 12:case"end":return t.stop()}}),t)})))();case 1:case"end":return t.stop()}}),t)}))),nt.apply(this,arguments)}var ot=function(){var t=n(a().mark((function t(e,r,n,o){var i,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i="notion_active_window_id",t.next=3,ct(i);case 3:if(!(c=t.sent)){t.next=8;break}return t.next=7,st(c.id,e);case 7:return t.abrupt("return",c);case 8:return t.next=10,ut(e,r,n,i,o);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t)})));return function(e,r,n,o){return t.apply(this,arguments)}}(),at=function(){var t=n(a().mark((function t(e){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"notion_active_window_id",t.next=3,ct("notion_active_window_id");case 3:if(!(r=t.sent)){t.next=8;break}return t.next=7,st(r.id,e);case 7:return t.abrupt("return",r);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),it=function(){var t=n(a().mark((function t(e,r,n,o){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(o.length>1)){t.next=4;break}return t.next=3,R(e,{width:o[1].bounds.width,height:o[1].bounds.height,left:o[1].bounds.left,top:o[1].bounds.top,focused:!0});case 3:case 10:return t.abrupt("return");case 4:if(!d()){t.next=11;break}return t.next=7,K();case 7:return i=t.sent,t.next=10,R(e,{width:Math.floor(i[0].bounds.width/2),height:Math.floor(i[0].bounds.height),top:0,left:Math.floor(i[0].bounds.width/2-(navigator.platform.toUpperCase().indexOf("MAC")>=0?0:12)),focused:!0});case 11:return t.next=13,R(e,{width:Math.floor(r/2),height:Math.floor(n),top:0,left:Math.floor(r/2-(navigator.platform.toUpperCase().indexOf("MAC")>=0?0:12)),focused:!0});case 13:case"end":return t.stop()}}),t)})));return function(e,r,n,o){return t.apply(this,arguments)}}(),ct=function(){var t=n(a().mark((function t(e){var r,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_([e]);case 2:if(r=t.sent,n=null,!Object.keys(r).length){t.next=14;break}return t.prev=5,t.next=8,F(r[e].id);case 8:n=t.sent,t.next=14;break;case 11:return t.prev=11,t.t0=t.catch(5),t.abrupt("return",n);case 14:return t.abrupt("return",n);case 15:case"end":return t.stop()}}),t,null,[[5,11]])})));return function(e){return t.apply(this,arguments)}}(),ut=function(){var e=n(a().mark((function e(r,n,o,i,c){var u,s,p,f;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(c.length>1)){e.next=8;break}return e.next=3,E({left:c[1].bounds.left,top:c[1].bounds.top,width:c[1].bounds.width,height:c[1].bounds.height,focused:!0,type:-1===r.indexOf("/notion/oauth/start")?"popup":"normal",url:r});case 3:return u=e.sent,e.next=6,I(t({},i,{id:u.tabs[0].id,windowId:u.tabs[0].windowId}));case 6:return u.windowId=u.tabs[0].windowId,e.abrupt("return",u);case 8:if(!d()){e.next=19;break}return e.next=11,K();case 11:return s=e.sent,e.next=14,E({focused:!0,left:Math.floor(s[0].bounds.width/2-(navigator.platform.toUpperCase().indexOf("MAC")>=0?0:12)),top:0,height:Math.floor(s[0].bounds.height),width:Math.floor(s[0].bounds.width/2),type:-1===r.indexOf("/notion/oauth/start")?"popup":"normal",url:r});case 14:return p=e.sent,e.next=17,I(t({},i,{id:p.tabs[0].id,windowId:p.tabs[0].windowId}));case 17:return p.windowId=p.tabs[0].windowId,e.abrupt("return",p);case 19:return e.next=21,E({focused:!0,left:Math.floor(n/2-(navigator.platform.toUpperCase().indexOf("MAC")>=0?0:12)),top:0,height:Math.floor(o),width:Math.floor(n/2),type:-1===r.indexOf("/notion/oauth/start")?"popup":"normal",url:r});case 21:return f=e.sent,e.next=24,I(t({},i,{id:f.tabs[0].id,windowId:f.tabs[0].windowId}));case 24:return f.windowId=f.tabs[0].windowId,e.abrupt("return",f);case 26:case"end":return e.stop()}}),e)})));return function(t,r,n,o,a){return e.apply(this,arguments)}}(),st=function(){var t=n(a().mark((function t(e,r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N(e,{highlighted:!0,url:r});case 2:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),pt=function(){var t=n(a().mark((function t(e,r,n,o){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(o.length>1)){t.next=4;break}return t.next=3,R(e,{width:o[0].bounds.width,height:o[0].bounds.height,top:o[0].bounds.top,left:o[0].bounds.left,state:"normal"});case 3:case 10:return t.abrupt("return");case 4:if(!d()){t.next=11;break}return t.next=7,K();case 7:return i=t.sent,t.next=10,R(e,{width:Math.floor(i[0].bounds.width/2),height:Math.floor(i[0].bounds.height),top:0,left:0,state:"normal"});case 11:return t.next=13,R(e,{width:Math.floor(r/2),height:Math.floor(n),top:0,left:0,state:"normal"});case 13:case"end":return t.stop()}}),t)})));return function(e,r,n,o){return t.apply(this,arguments)}}(),ft=function(){var t=n(a().mark((function t(e,r,n,o){var i,c,u,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(o.length>1)){t.next=6;break}return t.next=3,E({focused:!0,left:o[0].bounds.left,top:o[0].bounds.top,height:o[0].bounds.height,width:o[0].bounds.width,type:"normal",url:e});case 3:return(i=t.sent).windowId=i.tabs[0].windowId,t.abrupt("return",i);case 6:if(!d()){t.next=15;break}return t.next=9,K();case 9:return c=t.sent,t.next=12,E({focused:!0,left:0,top:0,height:Math.floor(c[0].bounds.height),width:Math.floor(c[0].bounds.width/2),type:"normal",url:e});case 12:return(u=t.sent).windowId=u.tabs[0].windowId,t.abrupt("return",u);case 15:return t.next=17,E({focused:!0,left:0,top:0,height:Math.floor(n),width:Math.floor(r/2),type:"normal",url:e});case 17:return(s=t.sent).windowId=s.tabs[0].windowId,t.abrupt("return",s);case 20:case"end":return t.stop()}}),t)})));return function(e,r,n,o){return t.apply(this,arguments)}}();function ht(){return(ht=n(a().mark((function t(e,r){var n,o,i,c,s,p,f,l,d,m,w,b,x,v,g,k,A,P,L,j,S,T,E,C,R,U,B,G,J;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("close-active-tab"!==e.cmd){t.next=4;break}return t.next=3,D(r.tab.id);case 3:return t.abrupt("return",{});case 4:if("open-premium-popup-bf"!==e.cmd){t.next=7;break}return chrome.tabs.create({url:chrome.runtime.getURL("/snipo-app/dist/index.html#/premium-popup-bf")}),t.abrupt("return",{});case 7:if("open-premium-popup"!==e.cmd){t.next=10;break}return chrome.tabs.create({url:chrome.runtime.getURL("/snipo-app/dist/index.html#/premium-popup")}),t.abrupt("return",{});case 10:if("open-link"!==e.cmd){t.next=14;break}return n=r.tab,chrome.tabs.update(n.id,{url:e.url}),t.abrupt("return",{});case 14:if("capture-tab"!==e.cmd){t.next=24;break}return t.next=17,_(["active_yt_window_id"]);case 17:if((o=t.sent).active_yt_window_id){t.next=20;break}return t.abrupt("return",{error:"video tab is not found"});case 20:return t.next=22,Y(o.active_yt_window_id.windowId,{format:"jpeg",quality:100});case 22:return i=t.sent,t.abrupt("return",{image:i});case 24:if("youtube-active-tab"!==e.cmd){t.next=31;break}return t.next=27,_(["active_yt_window_id"]);case 27:if(!(c=t.sent).active_yt_window_id||c.active_yt_window_id.id!==r.tab.id){t.next=30;break}return t.abrupt("return",{status:!0});case 30:return t.abrupt("return",{status:!1});case 31:if("notion-active-tab"!==e.cmd){t.next=42;break}return s=r.tab,t.next=35,_(["notion_active_window_id","active_platform"]);case 35:if(!(p=t.sent).notion_active_window_id||!s||p.notion_active_window_id.windowId!==s.windowId){t.next=41;break}return t.next=39,Z();case 39:return f=t.sent,t.abrupt("return",{status:!0,activePlatform:p.active_platform,commands:f});case 41:return t.abrupt("return",{status:!1,activePlatform:p.active_platform});case 42:if("notion-is-open"!==e.cmd){t.next=48;break}return"notion_active_window_id",t.next=46,ct("notion_active_window_id");case 46:return l=t.sent,t.abrupt("return",{status:null!=l});case 48:if("open-course-platform"!==e.cmd){t.next=127;break}return t.next=51,H();case 51:return d=t.sent,m=r.tab,t.next=55,I({notion_active_window_id:{id:m.id,windowId:m.windowId}});case 55:return t.next=57,_(["active_yt_window_id"]);case 57:if(w=t.sent,b=new URL(e.url).searchParams,x=b.get("list")||"",v=b.get("v")||"",!x){t.next=66;break}return t.next=64,I({active_playlist_video:v,active_playlist:x});case 64:t.next=68;break;case 66:return t.next=68,I({active_playlist_video:v});case 68:if(g=null,!w.active_yt_window_id){t.next=104;break}return t.prev=70,t.next=73,F(w.active_yt_window_id.id);case 73:if(k=t.sent,(A=new URL(k.url)).searchParams.delete("t"),A.searchParams.delete("via"),A.searchParams.delete("autoplay"),A.hash="","skillshare"===e.type&&(A.href=A.href.split("/").slice(0,7).join("/"),A.searchParams.delete("list")),"ted"===e.type&&(A.href=A.href.split("/").slice(0,5).join("/")),"udemy"===e.type&&(A.searchParams.delete("list"),A.searchParams.delete("v")),"coursera"===e.type&&(A.searchParams.delete("list"),A.searchParams.delete("v")),"bilibili"===e.type&&(A.href=A.origin+A.pathname),0===e.url.indexOf(A.href)){t.next=89;break}return t.next=87,N(w.active_yt_window_id.id,{highlighted:!0,url:e.url});case 87:t.next=93;break;case 89:if(!(P=new URL(e.url)).searchParams.get("t")){t.next=93;break}return chrome.storage.local.set({action:{cmd:"to_time",t:P.searchParams.get("t").replace("s","")}}),t.abrupt("return");case 93:t.next=102;break;case 95:return t.prev=95,t.t0=t.catch(70),t.next=99,it(m.windowId,e.width,e.height,d);case 99:return t.next=101,ft(e.url,e.width,e.height,d);case 101:g=t.sent;case 102:t.next=110;break;case 104:return"linkedin"===e.type&&(e.url+="&autoplay=true"),t.next=107,it(m.windowId,e.width,e.height,d);case 107:return t.next=109,ft(e.url,e.width,e.height,d);case 109:g=t.sent;case 110:return t.next=112,h(500);case 112:if(!g){t.next=126;break}return t.t1=Promise,t.next=116,it(m.windowId,e.width,e.height,d);case 116:return t.t2=t.sent,t.next=119,pt(g.windowId,e.width,e.height,d);case 119:return t.t3=t.sent,t.next=122,I({active_yt_window_id:{id:g.tabs[0].id,windowId:g.windowId}});case 122:return t.t4=t.sent,t.t5=[t.t2,t.t3,t.t4],t.next=126,t.t1.all.call(t.t1,t.t5);case 126:return t.abrupt("return",{});case 127:if("mixpanel_request"!=e.cmd){t.next=130;break}return t.next=130,y(e.url);case 130:if("open-notion-page"!==e.cmd){t.next=196;break}return t.next=133,H();case 133:if(L=t.sent,!e.autoReload){t.next=138;break}return j=chrome.runtime.getURL("/snipo-app/dist/index.html#/loading"),t.next=138,at(j);case 138:return t.next=140,M(["source","referral"]);case 140:return S=t.sent,T=S.source||"",E=S.referral||"",C=r.tab,R="https://oauth.snipo.io/notion/oauth/start?source="+T+"&referral="+E+"&t="+(new Date).getTime(),t.next=147,O();case 147:if(U=t.sent){t.next=153;break}return t.next=151,I({first_open:JSON.stringify(e)});case 151:t.next=165;break;case 153:return t.next=155,u(U,e.playlistData,e.videoData,e.type);case 155:if(!("error"in(B=t.sent))||"auth"===B.error||"auth-only-notion"===B.error){t.next=158;break}return t.abrupt("return",B);case 158:if("error"in B&&"auth-only-notion"===B.error&&(R+="&p=notion"),!("url"in B)){t.next=163;break}R=B.url,t.next=165;break;case 163:return t.next=165,I({first_open:JSON.stringify(e)});case 165:if(!e.playlistData.id){t.next=170;break}return t.next=168,I({active_playlist_video:e.videoData.id,active_playlist:e.playlistData.id,active_platform:e.type});case 168:t.next=172;break;case 170:return t.next=172,I({active_platform:e.type});case 172:if(e.reopen){t.next=178;break}if(e.autoReload){t.next=176;break}return t.next=176,pt(C.windowId,e.width,e.height,L);case 176:return t.next=178,I({active_yt_window_id:{id:C.id,windowId:C.windowId}});case 178:return t.next=180,ot(R,e.width,e.height,L);case 180:if(G=t.sent,!e.reopen){t.next=183;break}return t.abrupt("return",{});case 183:return t.next=185,h(500);case 185:if(e.autoReload){t.next=196;break}return t.t6=Promise,t.next=189,pt(C.windowId,e.width,e.height,L);case 189:return t.t7=t.sent,t.next=192,it(G.windowId,e.width,e.height,L);case 192:return t.t8=t.sent,t.t9=[t.t7,t.t8],t.next=196,t.t6.all.call(t.t6,t.t9);case 196:return"send-notification"===e.cmd&&(J={type:"basic",iconUrl:"/icon/icon_48.png",title:"Snipo notification",message:"A new update is available",priority:2},this.isFirefox||(J.buttons=[{title:"Open link"},{title:"Disable push notifications"}]),chrome.notifications.create(Date.now().toString(),J)),t.abrupt("return",{});case 198:case"end":return t.stop()}}),t,this,[[70,95]])})))).apply(this,arguments)}chrome.runtime.onMessage.addListener((function(t,e,r){return function(t,e){return ht.apply(this,arguments)}(t,e).then(r),!0})),function(){nt.apply(this,arguments)}(),chrome.runtime.setUninstallURL&&chrome.runtime.setUninstallURL(function(){switch(!0){case m():return"https://bit.ly/3ZAD0cA";case w():return"https://bit.ly/3nt0YZZ";case b():return"https://bit.ly/3nziv2J";default:return"https://bit.ly/3Zyrdvl"}}()),chrome.contextMenus.removeAll(),chrome.contextMenus.create({id:"1113",title:"â­Rate me",contexts:[chrome.browserAction?"browser_action":"action"]}),chrome.contextMenus.create({id:"1114",title:"â¯ï¸Youtube",contexts:[chrome.browserAction?"browser_action":"action"]}),chrome.contextMenus.create({id:"1115",title:"ðŸ¤–Reddit",contexts:[chrome.browserAction?"browser_action":"action"]}),chrome.contextMenus.create({id:"1116",title:"ðŸ‘‹Twitter",contexts:[chrome.browserAction?"browser_action":"action"]}),chrome.contextMenus.create({id:"1117",title:"ðŸ‘‹Telegram",contexts:[chrome.browserAction?"browser_action":"action"]}),chrome.contextMenus.create({id:"1118",title:"ðŸ‘‹Discord",contexts:[chrome.browserAction?"browser_action":"action"]}),chrome.contextMenus.onClicked.addListener((function(t){"1113"===t.menuItemId?chrome.tabs.create({url:v()},(function(){})):"1114"===t.menuItemId?chrome.tabs.create({url:"https://www.youtube.com/channel/UCh0em1ePIv5ZlvU3BOr_Lfg?sub_confirmation=1"},(function(){})):"1115"===t.menuItemId?chrome.tabs.create({url:"https://www.reddit.com/r/snipo_io"},(function(){})):"1116"===t.menuItemId?chrome.tabs.create({url:"https://twitter.com/snipo_io"},(function(){})):"1117"===t.menuItemId?chrome.tabs.create({url:"https://t.me/snipo_io"},(function(){})):"1118"===t.menuItemId&&chrome.tabs.create({url:"https://discord.gg/dMa6WVEKkw"},(function(){}))})),chrome.commands.onCommand.addListener(function(){var t=n(a().mark((function t(e){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,_(["notion_active_window_id"]);case 3:r=t.sent,chrome.windows.update(r.notion_active_window_id.windowId,{focused:!0}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:"clip"==e||"back5s"==e||"skip5s"==e||"transcript"==e?chrome.storage.local.set({notionAction:e}):chrome.storage.local.set({action:{cmd:e}});case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}()),n(a().mark((function e(){var r,o,i,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="upd4",e.next=3,M(["install_date",r,"uuid"]);case 3:if(o=e.sent,i="#e53935",c="NEW",u="https://bit.ly/3Dz2RsS",!(!("install_date"in o)||o.install_date>(new Date).getTime()-24192e5||o[r])){e.next=9;break}return e.abrupt("return");case 9:(chrome.browserAction?chrome.browserAction:chrome.action).setPopup({popup:""}),(chrome.browserAction?chrome.browserAction:chrome.action).setBadgeText({text:c}),(chrome.browserAction?chrome.browserAction:chrome.action).setBadgeTextColor&&(chrome.browserAction?chrome.browserAction:chrome.action).setBadgeTextColor({color:"white"}),(chrome.browserAction?chrome.browserAction:chrome.action).setBadgeBackgroundColor({color:i}),(chrome.browserAction?chrome.browserAction:chrome.action).onClicked.addListener(n(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(t){(chrome.browserAction?chrome.browserAction:chrome.action).getBadgeText({},(function(e){t({text:e})}))}));case 2:if(e.sent.text===c){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,S(t({},r,!0));case 7:return chrome.tabs.create({url:u}),(chrome.browserAction?chrome.browserAction:chrome.action).setPopup({popup:chrome.runtime.getManifest().browser_action?chrome.runtime.getManifest().browser_action.default_popup:chrome.runtime.getManifest().action.default_popup}),(chrome.browserAction?chrome.browserAction:chrome.action).setBadgeText({text:""}),app.analytics.init("e4c9b5b21e2fa0e9f7d70f28548f6391","uuid"in o?o.uuid:"unknown","install_date"in o?o.install_date:(new Date).getTime()),e.next=13,y(app.analytics.track("popup_"+r+"_badge_open",{},!0));case 13:case"end":return e.stop()}}),e)})))),chrome.storage.onChanged.addListener(function(){var t=n(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("sync"===n){t.next=2;break}return t.abrupt("return");case 2:if(!(r in e)){t.next=10;break}return(chrome.browserAction?chrome.browserAction:chrome.action).setPopup({popup:chrome.runtime.getManifest().browser_action?chrome.runtime.getManifest().browser_action.default_popup:chrome.runtime.getManifest().action.default_popup}),t.next=6,new Promise((function(t){(chrome.browserAction?chrome.browserAction:chrome.action).getBadgeText({},(function(e){t({text:e})}))}));case 6:if(t.sent.text===c){t.next=9;break}return t.abrupt("return");case 9:(chrome.browserAction?chrome.browserAction:chrome.action).setBadgeText({text:""});case 10:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}());case 15:case"end":return e.stop()}}),e)})))()})()})();